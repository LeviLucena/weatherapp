<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Previsão do Tempo - WeatherApp</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet" />
</head>

<body>
    <div class="container">
        <header class="header">
            <img src="{{ url_for('static', filename='logo.png') }}" alt="WeatherApp Logo">
            <h1>Previsão do Tempo nos Municípios Brasileiros</h1>
            <p>Consulte as condições climáticas em tempo real e previsões para qualquer cidade do Brasil</p>
        </header>

        <div class="form-container">
            <form method="POST" action="{{ url_for('main.home') }}">
                <div class="form-group">
                    <label for="estado" class="form-label">Selecione o estado:</label>
                    <select id="estado" name="estado" class="form-select" required>
                        <option value="" disabled selected>Selecione um estado</option>
                        {% for estado in estados %}
                        <option value="{{ estado.codigo_uf }}" {% if estado.codigo_uf==estado_selecionado %}selected{% endif %}>
                            {{ estado.nome }} ({{ estado.uf }})
                        </option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label for="municipio" class="form-label">Selecione o município:</label>
                    <select id="municipio" name="municipio" class="form-select" required>
                        <option value="" disabled selected>Selecione um município</option>
                        {% if municipios %}
                        {% for m in municipios %}
                        <option value="{{ m.nome }}" {% if m.nome==municipio_selecionado %}selected{% endif %}>
                            {{ m.nome }}
                        </option>
                        {% endfor %}
                        {% endif %}
                    </select>
                </div>

                <button type="submit" class="btn-submit">
                    <i class="bi bi-search"></i> Ver Clima e Previsão
                </button>
            </form>
        </div>

        {% if weather and 'current' in weather %}
        <div class="card">
            <div class="card-header">
                <h3>Clima Atual em {{ municipio_selecionado }}, {{ estado_selecionado_nome }}</h3>
            </div>
            <div class="card-body">
                <div class="current-weather">
                    <div class="current-temp">
                        <img src="https:{{ weather['current']['condition']['icon'] }}" alt="{{ weather['current']['condition']['text'] }}" class="weather-icon">
                        <div class="temp-value">{{ weather['current']['temp_c'] }}°C</div>
                        <div class="condition-text">{{ weather['current']['condition']['text'] }}</div>
                        <div class="feels-like">Sensação térmica: {{ weather['current']['feelslike_c'] }}°C</div>
                    </div>
                    
                    <div class="weather-details">
                        <div class="detail-item">
                            <div class="detail-label">Umidade</div>
                            <div class="detail-value">{{ weather['current']['humidity'] }}%</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Vento</div>
                            <div class="detail-value">{{ weather['current']['wind_kph'] }} km/h</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Direção do Vento</div>
                            <div class="detail-value">{{ weather['current']['wind_dir'] }}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Pressão</div>
                            <div class="detail-value">{{ weather['current']['pressure_mb'] }} mb</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Visibilidade</div>
                            <div class="detail-value">{{ weather['current']['vis_km'] }} km</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Índice UV</div>
                            <div class="detail-value">{{ weather['current']['uv'] }}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Nuvens</div>
                            <div class="detail-value">{{ weather['current']['cloud'] }}%</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Atualizado em</div>
                            <div class="detail-value">{{ weather['current']['last_updated'] }}</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% elif weather and 'error' in weather %}
        <div class="card">
            <div class="card-header">
                <h3>Erro ao obter dados climáticos</h3>
            </div>
            <div class="card-body">
                <p class="text-danger">Ocorreu um erro ao buscar os dados climáticos: {{ weather['error'] }}</p>
                {% if '401' in weather['error'] %}
                <p>Erro 401: Chave de API inválida ou não autorizada. Por favor, verifique sua chave de API no arquivo .env.</p>
                <p>Para obter uma chave válida, visite: <a href="https://www.weatherapi.com/signup.aspx" target="_blank">https://www.weatherapi.com/signup.aspx</a></p>
                {% else %}
                <p>Por favor, verifique sua chave de API e tente novamente.</p>
                {% endif %}
            </div>
        </div>
        {% endif %}

        {% if forecast %}
        <div class="card">
            <div class="card-header">
                <h3>Dados Astronômicos - {{ municipio_selecionado }}</h3>
            </div>
            <div class="card-body">
                {% if forecast and forecast[0] and 'astro' in forecast[0] %}
                <div class="astronomy-grid">
                    <div class="astronomy-item">
                        <div class="astronomy-label">Nascer do Sol</div>
                        <div class="astronomy-value">{{ forecast[0]['astro']['sunrise'] }}</div>
                    </div>
                    <div class="astronomy-item">
                        <div class="astronomy-label">Pôr do Sol</div>
                        <div class="astronomy-value">{{ forecast[0]['astro']['sunset'] }}</div>
                    </div>
                    <div class="astronomy-item">
                        <div class="astronomy-label">Nascer da Lua</div>
                        <div class="astronomy-value">{{ forecast[0]['astro']['moonrise'] }}</div>
                    </div>
                    <div class="astronomy-item">
                        <div class="astronomy-label">Pôr da Lua</div>
                        <div class="astronomy-value">{{ forecast[0]['astro']['moonset'] }}</div>
                    </div>
                    <div class="astronomy-item">
                        <div class="astronomy-label">Fase da Lua</div>
                        <div class="astronomy-value">{{ forecast[0]['astro']['moon_phase'] }}</div>
                    </div>
                    <div class="astronomy-item">
                        <div class="astronomy-label">Iluminação da Lua</div>
                        <div class="astronomy-value">{{ forecast[0]['astro']['moon_illumination'] }}%</div>
                    </div>
                </div>
                {% else %}
                <p class="text-warning">Dados astronômicos não disponíveis para esta localização.</p>
                {% endif %}
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h3>Previsão para os Próximos Dias - {{ municipio_selecionado }}</h3>
            </div>
            <div class="card-body">
                <div class="forecast-container">
                    {% for day in forecast %}
                    {% if day and 'day' in day %}
                    <div class="forecast-card">
                        <div class="forecast-date">{{ day.date }}</div>
                        <img src="https:{{ day.day.condition.icon }}" alt="{{ day.day.condition.text }}" class="forecast-icon">
                        <div class="forecast-temp">
                            <span class="forecast-high">{{ day.day.maxtemp_c }}°</span>
                            <span class="forecast-low">{{ day.day.mintemp_c }}°</span>
                        </div>
                        <div class="forecast-condition">{{ day.day.condition.text }}</div>
                        <div class="detail-item">
                            <div class="detail-label">Chance de Chuva</div>
                            <div class="detail-value">{{ day.day.daily_chance_of_rain }}%</div>
                        </div>
                    </div>
                    {% endif %}
                    {% endfor %}
                </div>
            </div>
        </div>
        {% elif forecast == None %}
        <div class="card">
            <div class="card-header">
                <h3>Erro ao obter previsão</h3>
            </div>
            <div class="card-body">
                <p class="text-danger">Ocorreu um erro ao buscar a previsão do tempo.</p>
            </div>
        </div>
        {% endif %}
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>